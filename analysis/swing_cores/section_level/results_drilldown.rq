BASE  <https://elections.ontotext.com/resource/>
PREFIX myp: <https://elections.ontotext.com/resource/prop/indirect/>
PREFIX myd: <https://elections.ontotext.com/resource/prop/direct/>
PREFIX election: <https://elections.ontotext.com/resource/election/>
PREFIX qb: <http://purl.org/linked-data/cube#>
PREFIX myc: <https://elections.ontotext.com/resource/prop/cube/>
PREFIX myps: <https://elections.ontotext.com/resource/prop/statement/>
PREFIX wd: <http://www.wikidata.org/entity/>
PREFIX mypq: <https://elections.ontotext.com/resource/prop/qualifier/>
PREFIX jurisdiction: <https://elections.ontotext.com/resource/jurisdiction/>

PREFIX my: <https://elections.ontotext.com/resource/entity/>
SELECT distinct *
WHERE {
    ?sec a my:Section ; ^myc:locality/qb:dataSet <cube/sofia-profiling> ;
           myd:streetAddress ?address ;
           myd:district/rdfs:label ?district ;
           myd:district/myd:number ?district_number ;
          myp:neighborhood [mypq:isPrimary true ; myps:neighborhood/rdfs:label ?GE] ;
          myd:matched_section ?match ;
    .
    ?match myd:inclusion_ratio ?avg_inclusion ; myd:type "geo-match" .

    ?v myd:section ?sec ; myd:main_election election:pi2023 ; myd:voters_count ?voters23_count ; myd:voters_voted_count ?voted23_count .
    [myc:locality ?sec ; myc:candidate "gerb-core" ; myc:votes ?gerb_core] .
    [myc:locality ?sec ; myc:candidate "dps-core" ;  myc:votes ?dps_core] .
    [myc:locality ?sec ; myc:candidate "ppdb" ; myc:votes ?ppdb_core] .
    [myc:locality ?sec ; myc:candidate "patriot-core" ; myc:votes ?patriot_core] .
    [myc:locality ?sec ; myc:candidate "socleft-core" ; myc:votes ?socleft_core] .
    [myc:locality ?sec ; myc:candidate "unvoted-core" ; myc:votes ?unvoted_core] .
    [myc:locality ?sec ; myc:candidate "swing" ; myc:votes ?swing] .
    ?v myd:section ?sec ; myd:link_html ?protocol .
bind(uri(concat("https://elections.ontotext.com/sparql?name=&infer=true&sameAs=true&query=BASE%20%20%3Chttps%3A%2F%2Felections.ontotext.com%2Fresource%2F%3E%0APREFIX%20myp%3A%20%3Chttps%3A%2F%2Felections.ontotext.com%2Fresource%2Fprop%2Findirect%2F%3E%0APREFIX%20myd%3A%20%3Chttps%3A%2F%2Felections.ontotext.com%2Fresource%2Fprop%2Fdirect%2F%3E%0APREFIX%20election%3A%20%3Chttps%3A%2F%2Felections.ontotext.com%2Fresource%2Felection%2F%3E%0APREFIX%20qb%3A%20%3Chttp%3A%2F%2Fpurl.org%2Flinked-data%2Fcube%23%3E%0APREFIX%20myc%3A%20%3Chttps%3A%2F%2Felections.ontotext.com%2Fresource%2Fprop%2Fcube%2F%3E%0APREFIX%20myps%3A%20%3Chttps%3A%2F%2Felections.ontotext.com%2Fresource%2Fprop%2Fstatement%2F%3E%0APREFIX%20wd%3A%20%3Chttp%3A%2F%2Fwww.wikidata.org%2Fentity%2F%3E%0APREFIX%20mypq%3A%20%3Chttps%3A%2F%2Felections.ontotext.com%2Fresource%2Fprop%2Fqualifier%2F%3E%0APREFIX%20jurisdiction%3A%20%3Chttps%3A%2F%2Felections.ontotext.com%2Fresource%2Fjurisdiction%2F%3E%0APREFIX%20mys%3A%20%3Chttps%3A%2F%2Felections.ontotext.com%2Fresource%2Fentity%2Fstatement%2F%3E%0A%0ASELECT%20*%0AWHERE%20%7B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%3Fsection%20myd%3Amatched_section%20%3Fmatch%20.%0A%20%20%20%20%20%20%20%20%20%20%20%20%3Fmatch%20myd%3Atype%20%22geo-match%22%20%3B%20%5Emyd%3Amatched_section%20%3C",encode_for_uri(str(?sec)),"%3E%20.%0A%20%20%20%20%20%20%20%20%20%20%20%20%3Fvoting%20myd%3Avoters_count%20%3Fvoters_count%20%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20myd%3Avoters_voted_count%20%3Fvoters_voted%20%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20myd%3Amain_election%20%3Felection%20%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20myd%3Aelection%2Fmyd%3Ajurisdiction%20%3Fmir%20%3B%0A%20%20%20%20%20%20%20%20%20%20%09%20%20%20%20%20%20%20%20myd%3Asection%20%3Fsection%20%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20myd%3Adate%20%3Fdate%20%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20myd%3Alink_html%20%3Fprot%20%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20.%0A%20%20%20%20%20%20%20%20%20%20%20%20optional%7B%3Fvoting%20myd%3Avotes_blanc_count%20%3Fnpn%20.%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%3Fsection%20myd%3Aplace%20%3Fplace%20%3B%20myd%3Amatched_section%20%3Fmatch%20.%0A%20%20%20%20%20%20%20%20%20%20%20%20optional%7B%3Fvoting%20myp%3Avote%20%5Bmyps%3Avote%2Fmyd%3Aparty%2Fmyd%3Aparty%20wd%3AQ752259%20%20%20%20%20%20%20%3B%20mypq%3Avalid_votes_recieved%20%3Fvotes_bsp%20%5D%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20optional%7B%3Fvoting%20myp%3Avote%20%5Bmyps%3Avote%2Fmyd%3Aparty%2Fmyd%3Aparty%20wd%3AQ164242%20%20%20%20%20%20%20%3B%20mypq%3Avalid_votes_recieved%20%3Fvotes_dps%20%5D%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20optional%7B%3Fvoting%20myp%3Avote%20%5Bmyps%3Avote%2Fmyd%3Aparty%2Fmyd%3Aparty%20wd%3AQ133968%20%20%20%20%20%20%20%3B%20mypq%3Avalid_votes_recieved%20%3Fvotes_gerb%20%5D%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20optional%7B%3Fvoting%20myp%3Avote%20%5Bmyps%3Avote%2Fmyd%3Aparty%2Fmyd%3Aparty%20wd%3AQ98098908%20%20%20%20%20%3B%20mypq%3Avalid_votes_recieved%20%3Fvotes_itn%20%5D%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20optional%7B%3Fvoting%20myp%3Avote%20%5Bmyps%3Avote%2Fmyd%3Aparty%2Fmyd%3Aparty%20wd%3AQ116769868%20%20%20%20%3B%20mypq%3Avalid_votes_recieved%20%3Fvotes_ppdb%20%5D%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20optional%7B%3Fvoting%20myp%3Avote%20%5Bmyps%3Avote%2Fmyd%3Aparty%2Fmyd%3Aparty%20wd%3AQ28943121%20%20%20%20%20%3B%20mypq%3Avalid_votes_recieved%20%3Fvotes_vuz%20%5D%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20optional%7B%3Fvoting%20myp%3Avote%20%5Bmyps%3Avote%2Fmyd%3Aparty%2Fmyd%3Aparty%20wd%3AQ111985616%20%20%20%20%3B%20mypq%3Avalid_votes_recieved%20%3Fvotes_bv%20%5D%7D%0A%20%20%20%20%20%20%20%09%09optional%7B%3Fvoting%20myp%3Avote%20%5Bmyps%3Avote%2Fmyd%3Aparty%2Fmyd%3Aparty%20wd%3AQ108601789%20%20%20%20%3B%20mypq%3Avalid_votes_recieved%20%3Fpp%5D%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20optional%7B%3Fvoting%20myp%3Avote%20%5B%20myps%3Avote%2Fmyd%3Aparty%2Fmyd%3Aparty%20wd%3AQ62808154%20%20%20%20%3B%20mypq%3Avalid_votes_recieved%20%3Fdb%5D%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20optional%7B%3Fvoting%20myp%3Avote%20%5B%20myps%3Avote%2Fmyd%3Aparty%2Fmyd%3Aparty%20wd%3AQ792527%20%20%20%20%20%20%3B%20mypq%3Avalid_votes_recieved%20%3Fvmro%5D%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20optional%7B%3Fvoting%20myp%3Avote%20%5B%20myps%3Avote%2Fmyd%3Aparty%2Fmyd%3Aparty%20wd%3AQ106393525%20%20%20%3B%20mypq%3Avalid_votes_recieved%20%3Fismv%5D%7D%0A%0A%7D%20order%20by%20desc(%3Fdate)%0A&execute")) as ?drilldown_link)
bind(uri(concat("https://yasgui.triply.cc/#query=BASE%20%20%3Chttps%3A%2F%2Felections.ontotext.com%2Fresource%2F%3E%0APREFIX%20my%3A%20%3Chttps%3A%2F%2Felections.ontotext.com%2Fresource%2Fentity%2F%3E%0APREFIX%20myd%3A%20%3Chttps%3A%2F%2Felections.ontotext.com%2Fresource%2Fprop%2Fdirect%2F%3E%0APREFIX%20election%3A%20%3Chttps%3A%2F%2Felections.ontotext.com%2Fresource%2Felection%2F%3E%0APREFIX%20mypq%3A%20%3Chttps%3A%2F%2Felections.ontotext.com%2Fresource%2Fprop%2Fqualifier%2F%3E%0APREFIX%20myps%3A%20%3Chttps%3A%2F%2Felections.ontotext.com%2Fresource%2Fprop%2Fstatement%2F%3E%0APREFIX%20myp%3A%20%3Chttps%3A%2F%2Felections.ontotext.com%2Fresource%2Fprop%2Findirect%2F%3E%0APREFIX%20geo%3A%20%3Chttp%3A%2F%2Fwww.opengis.net%2Font%2Fgeosparql%23%3E%0A%0A%0Aselect%20distinct%20%3Fsec%20%3FSECTION%20%3FSECTIONTooltip%20%3FSECTIONColor%20where%20%7B%0A%20%20values%20%3Felection%20%20%7B%0A%20%20%20%20election%3Api2023%20%0A%20%20%20%20election%3Api2022%0A%20%20%20%20election%3Api2021%20%0A%20%20%20%20election%3Api2021_07%20%0A%20%20%20%20election%3Api2021_11%20%0A%20%20%20%20election%3Ami2019%20%0A%20%20%7D%20%0A%0A%20%20%3Fsec%20a%20my%3ASection%20%3B%20myd%3Amain_election%20%3Felection%3B%20geo%3AhasGeometry%2Fgeo%3AasWKT%20%3FSECTION%20%3B%20myd%3Amatched_section%20%3C",encode_for_uri(str(?match)),"%3E%0A%20%20bind(%3Felection%20as%20%3FSECTIONTooltip)%20%0A%7D&endpoint=https%3A%2F%2Felections.ontotext.com%2Frepositories%2Felections&requestMethod=GET&tabTitle=Query&headers=%7B%7D&contentTypeConstruct=application%2Fn-triples%2C*%2F*%3Bq%3D0.9&contentTypeSelect=application%2Fsparql-results%2Bjson%2C*%2F*%3Bq%3D0.9&close&outputFormat=geo&outputSettings=%7B%7D")) as ?match_viz_link)
}